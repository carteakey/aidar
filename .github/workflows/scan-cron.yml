name: Weekly domain scan

on:
  schedule:
    - cron: "0 3 * * 1"   # Every Monday at 03:00 UTC
  workflow_dispatch:        # Allow manual trigger from GitHub UI

jobs:
  scan:
    name: Re-scan tracked domains
    runs-on: ubuntu-latest

    # Runs aidar track via `heroku run` on the production dyno so it uses
    # the Heroku Postgres DB (DATABASE_URL).  Requires:
    #   - HEROKU_API_KEY secret set in repo settings
    #   - HEROKU_APP_NAME secret (e.g. "aidar")
    steps:
      - name: Install Heroku CLI
        run: curl https://cli-assets.heroku.com/install.sh | sh

      - name: Scan tracked domains
        env:
          HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
        run: |
          APP=${{ secrets.HEROKU_APP_NAME }}

          # Add domains to this list as you expand the corpus
          DOMAINS=(
            "carteakey.dev"
            "simonwillison.net"
          )

          for domain in "${DOMAINS[@]}"; do
            echo "=== Scanning $domain ==="
            heroku run --app "$APP" --exit-code \
              bash scripts/run-track.sh "$domain"
          done
